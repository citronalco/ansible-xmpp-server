# {{ ansible_managed }}

# Hostname
server-name={{ prosody.web_domain.name }}

# Ports that clients can connect to
listening-port=3478
alt-listening-port=3479

tls-listening-port=5349
alt-tls-listening-port=5350

# TLS configuration - not required, but we have the certificate, so why not
cert=/etc/pki/coturn/xmpp.bytewerk.org/fullchain.pem
pkey=/etc/pki/coturn/xmpp.bytewerk.org/privkey.pem
# https://ssl-config.mozilla.org/#server=haproxy&version=2.1&config=intermediate&openssl=1.1.0g&guideline=5.4
cipher-list=ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
no-tlsv1
no-tlsv1_1

# disable connections from multicast addresses
no-multicast-peers
# disable command line access
no-cli

# Realm must be set. Its value does not matter when using a shared secret for authentication as we do
realm={{ prosody.web_domain.name }}

# More security for TURN
fingerprint
stale-nonce
# No Bandwith limit for TURN
total-quota=100
bps-capacity=0

# use a shared secret for TURN connections with other programs, must also be set in /etc/prosody/prosody.cfg.lua (STUN does not need authentication)
use-auth-secret
static-auth-secret={{ turnpwd }}

# Logging
#verbose
#Verbose
log-file=/var/log/coturn/turnserver.log
simple-log

# HOW TO TEST:
# For testing on https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/:
# STUN: "stun:{{ prosody.web_domain.name }}:3478", username empty, password empty. Result's last line must contain "srflx".
# TURN: comment "use-auth-secret" and "static-auth-secret" above, enable a test user by uncommenting the line "user=test:test" below and restart coturn. Then use "turn:{{ prosody.web_domain.name }}:3478", username=test, password=test. Result's last line must contain "relay".
#user=test:test
