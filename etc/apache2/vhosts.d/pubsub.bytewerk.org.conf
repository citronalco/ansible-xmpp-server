# Für Prosody
# - wird nur zum Erstellen des LetsEncrypt-Zertifikats "pubsub.bytewerk.org" benötigt

<VirtualHost *:80>
    ServerName pubsub.bytewerk.org

    ServerAdmin webmaster@bytewerk.org

    DocumentRoot /srv/var/www/vhosts/pubsub.bytewerk.org

    # Logging
    ErrorLog /var/log/apache2/pubsub.bytewerk.org-error_log
    CustomLog "|/usr/bin/python3 /usr/local/Anonip.git/anonip.py --skip-private --output /var/log/apache2/pubsub.bytewerk.org-access_log" combined env=!dontlog

    # don't loose time with IP address lookups
    HostnameLookups Off

    # needed for named virtual hosts
    UseCanonicalName Off

    # Weiterleiten zu HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R=301,L]
</VirtualHost>


<VirtualHost *:443>
    ServerName pubsub.bytewerk.org

    ServerAdmin webmaster@bytewerk.org

    DocumentRoot /srv/var/www/vhosts/pubsub.bytewerk.org

    # Logging
    ErrorLog /var/log/apache2/pubsub.bytewerk.org-error_log
    CustomLog "|/usr/bin/python3 /usr/local/Anonip.git/anonip.py --skip-private --output /var/log/apache2/pubsub.bytewerk.org-access_log" combined env=!dontlog

    # don't loose time with IP address lookups
    HostnameLookups Off

    # needed for named virtual hosts
    UseCanonicalName Off

    # LetsEncrypt
    SSLCertificateFile /etc/letsencrypt/live/pubsub.bytewerk.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/pubsub.bytewerk.org/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    Redirect 301 / https://xmpp.bytewerk.org/
</VirtualHost>
